<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carnet de Bord - Suivi de VÃ©hicules</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        /* Styles pour la page de connexion */
        .login-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-box {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        .login-logo {
            width: 80px;
            height: 80px;
            background: #f39c12;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.8rem;
            color: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            margin: 0 auto 20px;
        }

        .cna-text {
            color: #27ae60;
            margin-left: -5px;
        }

        .login-box h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.8rem;
        }

        .login-box p {
            color: #6c757d;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .login-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .login-btn:hover {
            background: linear-gradient(135deg, #2980b9, #1f5582);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #f5c6cb;
            display: none;
        }

        .logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.3s ease;
        }

        .logout-btn:hover {
            background: #c0392b;
        }

        /* Styles pour l'application principale */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            display: none;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .cna-logo {
            width: 80px;
            height: 80px;
            background: #f39c12;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.8rem;
            color: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            flex-shrink: 0;
        }

        .header-text {
            text-align: left;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }

        .nav-tab {
            flex: 1;
            padding: 15px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.3s ease;
        }

        .nav-tab.active {
            background: white;
            color: #3498db;
            border-bottom: 3px solid #3498db;
        }

        .nav-tab:hover {
            background: #e9ecef;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }

        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            accent-color: #3498db;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #2980b9, #1f5582);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60, #229954);
            color: white;
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #229954, #1e8449);
            transform: translateY(-2px);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
        }

        .btn-warning:hover {
            background: linear-gradient(135deg, #e67e22, #d35400);
            transform: translateY(-2px);
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #c0392b, #a93226);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, #5a6268, #495057);
            transform: translateY(-2px);
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.8rem;
            margin: 2px;
        }

        .actions-column {
            white-space: nowrap;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        .modal-header h2 {
            color: #2c3e50;
            margin: 0;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: #6c757d;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            color: #e74c3c;
        }

        .confirm-dialog {
            text-align: center;
            padding: 20px;
        }

        .confirm-dialog h3 {
            color: #e74c3c;
            margin-bottom: 15px;
        }

        .confirm-dialog p {
            margin-bottom: 25px;
            color: #6c757d;
        }

        .confirm-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 25px;
            border-radius: 12px;
            border-left: 5px solid #3498db;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .stat-card h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .stat-card .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 5px;
        }

        .stat-card .stat-label {
            color: #6c757d;
            font-size: 0.9rem;
        }

        .table-container {
            overflow-x: auto;
            margin-top: 20px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        th {
            background: linear-gradient(135deg, #34495e, #2c3e50);
            color: white;
            padding: 15px 10px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
        }

        td {
            padding: 12px 10px;
            border-bottom: 1px solid #e9ecef;
            font-size: 0.9rem;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .vehicle-plate {
            background: #3498db;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .trip-type {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .trip-type.professional {
            background: #e8f5e8;
            color: #27ae60;
        }

        .trip-type.private {
            background: #fff3cd;
            color: #856404;
        }

        .alert {
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
            font-weight: 500;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .vehicle-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #2196f3;
        }

        .vehicle-info strong {
            color: #1976d2;
        }

        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filters select {
            padding: 8px 12px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            background: white;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .filters {
                flex-direction: column;
                align-items: stretch;
            }
            
            .container {
                margin: 10px;
                border-radius: 10px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2rem;
            }

            .logout-btn {
                position: static;
                margin: 10px auto;
                display: block;
            }
        }
    </style>
</head>
<body>
    <!-- Page de connexion -->
    <div id="loginPage" class="login-container">
        <div class="login-box">
            <div class="login-logo">
                C<span class="cna-text">NA</span>
            </div>
            <h1>ð Connexion</h1>
            <p>Centre National des Archives<br>Carnet de Bord - Suivi de VÃ©hicules</p>
            
            <div id="errorMessage" class="error-message">
                Mot de passe incorrect. Veuillez rÃ©essayer.
            </div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label for="password">Mot de passe</label>
                    <input type="password" id="password" placeholder="Saisissez votre mot de passe" required>
                </div>
                <button type="submit" class="login-btn">Se connecter</button>
            </form>
        </div>
    </div>

    <!-- Bouton de dÃ©connexion -->
    <button id="logoutBtn" class="logout-btn" style="display: none;" onclick="logout()">
        ðª DÃ©connexion
    </button>

    <!-- Application principale -->
    <div class="container" id="mainApp">
        <div class="header">
            <div class="header-content">
                <div class="cna-logo">
                    C<span class="cna-text">NA</span>
                </div>
                <div class="header-text">
                    <h1>ð Carnet de Bord</h1>
                    <p>Suivi et gestion des dÃ©placements de vÃ©hicules</p>
                    <small style="opacity: 0.8;">Centre National des Archives</small>
                </div>
            </div>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('add-trip')">Nouveau DÃ©placement</button>
            <button class="nav-tab" onclick="switchTab('dashboard')">Tableau de Bord</button>
            <button class="nav-tab" onclick="switchTab('history')">Historique</button>
        </div>

        <!-- Onglet Nouveau DÃ©placement -->
        <div id="add-trip" class="tab-content active">
            <h2>Ajouter un nouveau dÃ©placement</h2>
            
            <form id="tripForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="vehicle">VÃ©hicule *</label>
                        <select id="vehicle" required>
                            <option value="">SÃ©lectionner un vÃ©hicule</option>
                            <option value="ford">Ford (Fourgon)</option>
                            <option value="renault">Renault Logan (Berline)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="driverName">PrÃ©nom et Nom de l'utilisateur *</label>
                        <input type="text" id="driverName" required>
                    </div>

                    <div class="form-group">
                        <label for="driverRegistration">Matricule de l'utilisateur *</label>
                        <input type="text" id="driverRegistration" required>
                    </div>

                    <div class="form-group">
                        <label for="departureDate">Date de sortie *</label>
                        <input type="datetime-local" id="departureDate" required>
                    </div>

                    <div class="form-group">
                        <label for="initialKm">KilomÃ©trage initial *</label>
                        <input type="number" id="initialKm" required min="0">
                    </div>

                    <div class="form-group">
                        <label for="tripType">Type de sortie *</label>
                        <select id="tripType" required>
                            <option value="">SÃ©lectionner le type</option>
                            <option value="professional">Professionnelle</option>
                            <option value="private">PrivÃ©e</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="tripPurpose">Objet du dÃ©placement *</label>
                        <input type="text" id="tripPurpose" required>
                    </div>

                    <div class="form-group">
                        <label for="itinerary">ItinÃ©raire</label>
                        <textarea id="itinerary" placeholder="DÃ©crivez l'itinÃ©raire suivi..."></textarea>
                    </div>

                    <div class="form-group">
                        <label for="returnDate">Date de retour *</label>
                        <input type="datetime-local" id="returnDate" required>
                    </div>

                    <div class="form-group">
                        <label for="finalKm">KilomÃ©trage final *</label>
                        <input type="number" id="finalKm" required min="0">
                    </div>

                    <div class="form-group">
                        <label for="distanceTraveled">KilomÃ¨tres parcourus</label>
                        <input type="number" id="distanceTraveled" readonly>
                    </div>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="usedToll">
                    <label for="usedToll">Passage par le pÃ©age</label>
                </div>

                <div class="form-group" id="tollAmountGroup" style="display: none;">
                    <label for="tollAmount">Montant payÃ© au pÃ©age (F CFA) *</label>
                    <input type="number" id="tollAmount" min="0">
                    <select id="tollDirection" style="margin-top: 10px;">
                        <option value="aller">Aller seulement</option>
                        <option value="retour">Retour seulement</option>
                        <option value="aller-retour">Aller-Retour</option>
                    </select>
                    <small style="color: #6c757d; margin-top: 5px; display: block;">
                        ð¡ Le montant sera automatiquement dÃ©duit de la carte de pÃ©age du vÃ©hicule
                    </small>
                </div>

                <div id="vehicleInfo" class="vehicle-info" style="display: none;">
                    <strong>Informations du vÃ©hicule sÃ©lectionnÃ© :</strong>
                    <div id="vehicleDetails"></div>
                </div>

                <button type="submit" class="btn btn-primary">Enregistrer le dÃ©placement</button>
            </form>

            <div id="successAlert" class="alert alert-success" style="display: none;">
                DÃ©placement enregistrÃ© avec succÃ¨s !
            </div>
        </div>

        <!-- Onglet Tableau de Bord -->
        <div id="dashboard" class="tab-content">
            <h2>Tableau de Bord</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>ð Ford (Fourgon)</h3>
                    <div class="stat-value" id="fordTrips">0</div>
                    <div class="stat-label">DÃ©placements</div>
                    <div class="stat-value" id="fordKm">0</div>
                    <div class="stat-label">KilomÃ¨tres parcourus</div>
                </div>

                <div class="stat-card">
                    <h3>ð Renault Logan</h3>
                    <div class="stat-value" id="renaultTrips">0</div>
                    <div class="stat-label">DÃ©placements</div>
                    <div class="stat-value" id="renaultKm">0</div>
                    <div class="stat-label">KilomÃ¨tres parcourus</div>
                </div>

                <div class="stat-card">
                    <h3>ð·ï¸ Carte PÃ©age Ford</h3>
                    <div class="stat-value" id="fordTollBalance">30,000</div>
                    <div class="stat-label">Solde restant (F CFA)</div>
                    <div class="stat-value" id="fordTollUsed">0</div>
                    <div class="stat-label">Montant utilisÃ© (F CFA)</div>
                    <div class="stat-value" id="fordTollRate">0%</div>
                    <div class="stat-label">Taux d'utilisation</div>
                </div>

                <div class="stat-card">
                    <h3>ð·ï¸ Carte PÃ©age Renault</h3>
                    <div class="stat-value" id="renaultTollBalance">30,000</div>
                    <div class="stat-label">Solde restant (F CFA)</div>
                    <div class="stat-value" id="renaultTollUsed">0</div>
                    <div class="stat-label">Montant utilisÃ© (F CFA)</div>
                    <div class="stat-value" id="renaultTollRate">0%</div>
                    <div class="stat-label">Taux d'utilisation</div>
                </div>
            </div>

            <h3>Statistiques par utilisateur</h3>
            <div id="driverStats" class="stats-grid">
                <!-- Les statistiques des utilisateurs seront gÃ©nÃ©rÃ©es ici -->
            </div>

            <button onclick="exportToCSV()" class="btn btn-success">ð Exporter en CSV</button>
        </div>

        <!-- Onglet Historique -->
        <div id="history" class="tab-content">
            <h2>Historique des dÃ©placements</h2>
            
            <div class="filters">
                <select id="filterVehicle">
                    <option value="">Tous les vÃ©hicules</option>
                    <option value="ford">Ford (Fourgon)</option>
                    <option value="renault">Renault Logan</option>
                </select>
                
                <select id="filterType">
                    <option value="">Tous les types</option>
                    <option value="professional">Professionnel</option>
                    <option value="private">PrivÃ©</option>
                </select>
                
                <input type="text" id="filterDriver" placeholder="Rechercher par utilisateur...">
            </div>

            <div class="table-container">
                <table id="tripsTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>VÃ©hicule</th>
                            <th>Utilisateur</th>
                            <th>Matricule</th>
                            <th>Type</th>
                            <th>Objet</th>
                            <th>Distance (km)</th>
                            <th>PÃ©age</th>
                            <th>Retour</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="tripsTableBody">
                        <!-- Les donnÃ©es seront insÃ©rÃ©es ici -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Modal pour modifier un dÃ©placement -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Modifier le dÃ©placement</h2>
                <button class="close-btn" onclick="closeEditModal()">&times;</button>
            </div>
            
            <form id="editTripForm">
                <input type="hidden" id="editTripId">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="editVehicle">VÃ©hicule *</label>
                        <select id="editVehicle" required>
                            <option value="">SÃ©lectionner un vÃ©hicule</option>
                            <option value="ford">Ford (Fourgon)</option>
                            <option value="renault">Renault Logan (Berline)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="editDriverName">PrÃ©nom et Nom de l'utilisateur *</label>
                        <input type="text" id="editDriverName" required>
                    </div>

                    <div class="form-group">
                        <label for="editDriverRegistration">Matricule de l'utilisateur *</label>
                        <input type="text" id="editDriverRegistration" required>
                    </div>

                    <div class="form-group">
                        <label for="editDepartureDate">Date de sortie *</label>
                        <input type="datetime-local" id="editDepartureDate" required>
                    </div>

                    <div class="form-group">
                        <label for="editInitialKm">KilomÃ©trage initial *</label>
                        <input type="number" id="editInitialKm" required min="0">
                    </div>

                    <div class="form-group">
                        <label for="editTripType">Type de sortie *</label>
                        <select id="editTripType" required>
                            <option value="">SÃ©lectionner le type</option>
                            <option value="professional">Professionnelle</option>
                            <option value="private">PrivÃ©e</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="editTripPurpose">Objet du dÃ©placement *</label>
                        <input type="text" id="editTripPurpose" required>
                    </div>

                    <div class="form-group">
                        <label for="editItinerary">ItinÃ©raire</label>
                        <textarea id="editItinerary" placeholder="DÃ©crivez l'itinÃ©raire suivi..."></textarea>
                    </div>

                    <div class="form-group">
                        <label for="editReturnDate">Date de retour *</label>
                        <input type="datetime-local" id="editReturnDate" required>
                    </div>

                    <div class="form-group">
                        <label for="editFinalKm">KilomÃ©trage final *</label>
                        <input type="number" id="editFinalKm" required min="0">
                    </div>

                    <div class="form-group">
                        <label for="editDistanceTraveled">KilomÃ¨tres parcourus</label>
                        <input type="number" id="editDistanceTraveled" readonly>
                    </div>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="editUsedToll">
                    <label for="editUsedToll">Passage par le pÃ©age</label>
                </div>

                <div class="form-group" id="editTollAmountGroup" style="display: none;">
                    <label for="editTollAmount">Montant payÃ© au pÃ©age (F CFA)</label>
                    <input type="number" id="editTollAmount" min="0">
                    <select id="editTollDirection" style="margin-top: 10px;">
                        <option value="aller">Aller seulement</option>
                        <option value="retour">Retour seulement</option>
                        <option value="aller-retour">Aller-Retour</option>
                    </select>
                </div>

                <div style="display: flex; gap: 15px; justify-content: flex-end; margin-top: 20px;">
                    <button type="button" class="btn btn-secondary" onclick="closeEditModal()">Annuler</button>
                    <button type="submit" class="btn btn-primary">Sauvegarder les modifications</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de confirmation de suppression -->
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <div class="confirm-dialog">
                <h3>â ï¸ Confirmer la suppression</h3>
                <p>Ãtes-vous sÃ»r de vouloir supprimer ce dÃ©placement ?<br>Cette action est irrÃ©versible.</p>
                <div class="confirm-buttons">
                    <button class="btn btn-secondary" onclick="closeDeleteModal()">Annuler</button>
                    <button class="btn btn-danger" onclick="confirmDelete()">Supprimer</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration pour l'authentification
        const DEFAULT_PASSWORD = 'cna2024';
        let isAuthenticated = false;

        // Configuration des vÃ©hicules
        const vehicles = {
            ford: {
                name: 'Ford (Fourgon)',
                plate: 'AA 696 ET',
                tollBalance: 30000
            },
            renault: {
                name: 'Renault Logan (Berline)',
                plate: 'DK 0953 BK',
                tollBalance: 30000
            }
        };

        // Stockage des donnÃ©es
        let trips = [];
        let tollUsage = { ford: 0, renault: 0 };

        // Variables globales pour la gestion des modals
        let editingTripId = null;
        let deletingTripId = null;

        // Fonction pour vÃ©rifier l'authentification
        function checkAuth() {
            const authStatus = window.vehicleAuth || false;
            if (authStatus) {
                showMainApp();
            } else {
                showLoginPage();
            }
        }

        // Fonction pour afficher la page de connexion
        function showLoginPage() {
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('logoutBtn').style.display = 'none';
            isAuthenticated = false;
        }

        // Fonction pour afficher l'application principale
        function showMainApp() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            document.getElementById('logoutBtn').style.display = 'block';
            isAuthenticated = true;
            
            // Charger les donnÃ©es et mettre Ã  jour les affichages
            loadData();
            updateDashboard();
            displayTripsHistory();
        }

        // Fonction pour gÃ©rer la connexion
        function handleLogin(e) {
            e.preventDefault();
            
            const passwordInput = document.getElementById('password');
            const errorMessage = document.getElementById('errorMessage');
            
            if (passwordInput.value === DEFAULT_PASSWORD) {
                // Authentification rÃ©ussie
                window.vehicleAuth = true;
                showMainApp();
                passwordInput.value = '';
                errorMessage.style.display = 'none';
            } else {
                // Mot de passe incorrect
                errorMessage.style.display = 'block';
                passwordInput.value = '';
                passwordInput.focus();
            }
        }

        // Fonction pour dÃ©connexion
        function logout() {
            window.vehicleAuth = false;
            showLoginPage();
        }

        // Charger les donnÃ©es depuis un stockage en mÃ©moire (pour la session)
        function loadData() {
            const storedTrips = window.vehicleTripsData;
            const storedTollUsage = window.vehicleTollUsage;
            
            if (storedTrips) {
                trips = [...storedTrips];
            }
            
            if (storedTollUsage) {
                tollUsage = {...storedTollUsage};
            }
        }

        // Sauvegarder les donnÃ©es en mÃ©moire
        function saveData() {
            window.vehicleTripsData = [...trips];
            window.vehicleTollUsage = {...tollUsage};
        }

        // Fonction pour changer d'onglet
        function switchTab(tabId) {
            // Masquer tous les contenus d'onglets
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Masquer tous les onglets actifs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Afficher l'onglet sÃ©lectionnÃ©
            document.getElementById(tabId).classList.add('active');
            
            // Activer le bouton d'onglet cliquÃ©
            event.target.classList.add('active');
            
            // Mettre Ã  jour les donnÃ©es si nÃ©cessaire
            if (tabId === 'dashboard') {
                updateDashboard();
            } else if (tabId === 'history') {
                displayTripsHistory();
            }
        }

        // Fonction pour mettre Ã  jour les informations du vÃ©hicule
        function updateVehicleInfo() {
            const vehicleSelect = document.getElementById('vehicle');
            const vehicleInfo = document.getElementById('vehicleInfo');
            const vehicleDetails = document.getElementById('vehicleDetails');
            
            if (vehicleSelect.value) {
                const vehicle = vehicles[vehicleSelect.value];
                vehicleDetails.innerHTML = `
                    <strong>ModÃ¨le :</strong> ${vehicle.name}<br>
                    <strong>Plaque d'immatriculation :</strong> <span class="vehicle-plate">${vehicle.plate}</span>
                `;
                vehicleInfo.style.display = 'block';
            } else {
                vehicleInfo.style.display = 'none';
            }
        }

        // Fonction pour calculer la distance automatiquement
        function calculateDistance() {
            const initialKm = parseFloat(document.getElementById('initialKm').value) || 0;
            const finalKm = parseFloat(document.getElementById('finalKm').value) || 0;
            const distance = finalKm - initialKm;
            
            if (distance >= 0) {
                document.getElementById('distanceTraveled').value = distance;
            } else {
                document.getElementById('distanceTraveled').value = '';
                alert('Le kilomÃ©trage final ne peut pas Ãªtre infÃ©rieur au kilomÃ©trage initial.');
            }
        }

        // Fonction pour afficher/masquer le montant du pÃ©age
        function toggleTollAmount() {
            const usedToll = document.getElementById('usedToll').checked;
            const tollAmountGroup = document.getElementById('tollAmountGroup');
            const tollAmountInput = document.getElementById('tollAmount');
            
            if (usedToll) {
                tollAmountGroup.style.display = 'block';
                tollAmountInput.required = true;
            } else {
                tollAmountGroup.style.display = 'none';
                tollAmountInput.required = false;
                tollAmountInput.value = '';
            }
        }

        // Fonction pour soumettre le formulaire
        function handleFormSubmit(e) {
            e.preventDefault();
            
            if (!isAuthenticated) {
                alert('Veuillez vous connecter pour utiliser cette fonctionnalitÃ©.');
                return;
            }
            
            // RÃ©cupÃ©rer les donnÃ©es du formulaire
            const formData = {
                id: Date.now(),
                vehicle: document.getElementById('vehicle').value,
                vehicleName: vehicles[document.getElementById('vehicle').value].name,
                vehiclePlate: vehicles[document.getElementById('vehicle').value].plate,
                driverName: document.getElementById('driverName').value,
                driverRegistration: document.getElementById('driverRegistration').value,
                departureDate: document.getElementById('departureDate').value,
                returnDate: document.getElementById('returnDate').value,
                initialKm: parseFloat(document.getElementById('initialKm').value),
                finalKm: parseFloat(document.getElementById('finalKm').value),
                distanceTraveled: parseFloat(document.getElementById('distanceTraveled').value),
                tripType: document.getElementById('tripType').value,
                tripPurpose: document.getElementById('tripPurpose').value,
                itinerary: document.getElementById('itinerary').value,
                usedToll: document.getElementById('usedToll').checked,
                tollAmount: parseFloat(document.getElementById('tollAmount').value) || 0,
                tollDirection: document.getElementById('tollDirection').value
            };

            // Validation des dates
            if (new Date(formData.returnDate) < new Date(formData.departureDate)) {
                alert('La date de retour ne peut pas Ãªtre antÃ©rieure Ã  la date de sortie.');
                return;
            }

            // Validation supplÃ©mentaire pour le pÃ©age
            if (formData.usedToll && (!formData.tollAmount || formData.tollAmount <= 0)) {
                alert('Veuillez saisir le montant du pÃ©age si vous avez cochÃ© "Passage par le pÃ©age".');
                return;
            }

            // VÃ©rifier si le solde de la carte est suffisant
            if (formData.usedToll && formData.tollAmount > 0) {
                const currentTollUsage = tollUsage[formData.vehicle] || 0;
                const remainingBalance = 30000 - currentTollUsage;
                
                if (formData.tollAmount > remainingBalance) {
                    alert(`Solde insuffisant sur la carte de pÃ©age ! Solde restant : ${remainingBalance.toLocaleString()} F CFA`);
                    return;
                }
            }

            // Ajouter le dÃ©placement Ã  la liste
            trips.push(formData);
            
            // Mettre Ã  jour l'usage du pÃ©age si applicable
            if (formData.usedToll && formData.tollAmount > 0) {
                if (!tollUsage[formData.vehicle]) {
                    tollUsage[formData.vehicle] = 0;
                }
                tollUsage[formData.vehicle] += formData.tollAmount;
            }
            
            // Sauvegarder les donnÃ©es
            saveData();
            
            // Afficher le message de succÃ¨s avec dÃ©tails
            const successAlert = document.getElementById('successAlert');
            let successMessage = 'DÃ©placement enregistrÃ© avec succÃ¨s !';
            
            if (formData.usedToll && formData.tollAmount > 0) {
                const remainingBalance = 30000 - tollUsage[formData.vehicle];
                successMessage += `<br>ð³ Montant dÃ©duit de la carte : ${formData.tollAmount.toLocaleString()} F CFA`;
                successMessage += `<br>ð° Solde restant : ${remainingBalance.toLocaleString()} F CFA`;
            }
            
            successAlert.innerHTML = successMessage;
            successAlert.style.display = 'block';
            setTimeout(() => {
                successAlert.style.display = 'none';
            }, 5000);
            
            // RÃ©initialiser le formulaire
            document.getElementById('tripForm').reset();
            document.getElementById('vehicleInfo').style.display = 'none';
            document.getElementById('tollAmountGroup').style.display = 'none';
        }

        // Fonction pour mettre Ã  jour le tableau de bord
        function updateDashboard() {
            // Statistiques par vÃ©hicule
            const fordTrips = trips.filter(trip => trip.vehicle === 'ford');
            const renaultTrips = trips.filter(trip => trip.vehicle === 'renault');
            
            document.getElementById('fordTrips').textContent = fordTrips.length;
            document.getElementById('fordKm').textContent = fordTrips.reduce((sum, trip) => sum + trip.distanceTraveled, 0).toLocaleString();
            
            document.getElementById('renaultTrips').textContent = renaultTrips.length;
            document.getElementById('renaultKm').textContent = renaultTrips.reduce((sum, trip) => sum + trip.distanceTraveled, 0).toLocaleString();
            
            // Soldes et taux d'utilisation des cartes de pÃ©age
            const fordTollUsed = tollUsage.ford || 0;
            const renaultTollUsed = tollUsage.renault || 0;
            const initialAmount = 30000;
            
            document.getElementById('fordTollUsed').textContent = fordTollUsed.toLocaleString();
            document.getElementById('fordTollBalance').textContent = (initialAmount - fordTollUsed).toLocaleString();
            document.getElementById('fordTollRate').textContent = ((fordTollUsed / initialAmount) * 100).toFixed(1) + '%';
            
            document.getElementById('renaultTollUsed').textContent = renaultTollUsed.toLocaleString();
            document.getElementById('renaultTollBalance').textContent = (initialAmount - renaultTollUsed).toLocaleString();
            document.getElementById('renaultTollRate').textContent = ((renaultTollUsed / initialAmount) * 100).toFixed(1) + '%';
            
            // Changer la couleur si le solde est faible
            if ((initialAmount - fordTollUsed) < 5000) {
                document.getElementById('fordTollBalance').style.color = '#e74c3c';
            } else {
                document.getElementById('fordTollBalance').style.color = '#3498db';
            }
            
            if ((initialAmount - renaultTollUsed) < 5000) {
                document.getElementById('renaultTollBalance').style.color = '#e74c3c';
            } else {
                document.getElementById('renaultTollBalance').style.color = '#3498db';
            }
            
            // Statistiques par chauffeur
            updateDriverStats();
        }

        // Fonction pour mettre Ã  jour les statistiques des utilisateurs
        function updateDriverStats() {
            const driverStatsContainer = document.getElementById('driverStats');
            const driverStats = {};
            
            // Calculer les statistiques pour chaque utilisateur
            trips.forEach(trip => {
                if (!driverStats[trip.driverName]) {
                    driverStats[trip.driverName] = {
                        name: trip.driverName,
                        registration: trip.driverRegistration,
                        trips: 0,
                        totalKm: 0
                    };
                }
                driverStats[trip.driverName].trips++;
                driverStats[trip.driverName].totalKm += trip.distanceTraveled;
            });
            
            // GÃ©nÃ©rer le HTML pour les statistiques des utilisateurs
            driverStatsContainer.innerHTML = '';
            Object.values(driverStats).forEach(driver => {
                const statCard = document.createElement('div');
                statCard.className = 'stat-card';
                statCard.innerHTML = `
                    <h3>ð¤ ${driver.name}</h3>
                    <small>Matricule: ${driver.registration}</small>
                    <div class="stat-value">${driver.trips}</div>
                    <div class="stat-label">DÃ©placements</div>
                    <div class="stat-value">${driver.totalKm.toLocaleString()}</div>
                    <div class="stat-label">KilomÃ¨tres parcourus</div>
                `;
                driverStatsContainer.appendChild(statCard);
            });
        }

        // Fonction pour afficher l'historique des dÃ©placements
        function displayTripsHistory() {
            const tbody = document.getElementById('tripsTableBody');
            tbody.innerHTML = '';
            
            trips.forEach(trip => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${new Date(trip.departureDate).toLocaleDateString('fr-FR')}</td>
                    <td>
                        ${trip.vehicleName}<br>
                        <span class="vehicle-plate">${trip.vehiclePlate}</span>
                    </td>
                    <td>${trip.driverName}</td>
                    <td>${trip.driverRegistration}</td>
                    <td><span class="trip-type ${trip.tripType}">${trip.tripType === 'professional' ? 'Prof.' : 'PrivÃ©'}</span></td>
                    <td>${trip.tripPurpose}</td>
                    <td>${trip.distanceTraveled.toLocaleString()}</td>
                    <td>${trip.usedToll ? trip.tollAmount.toLocaleString() + ' F CFA' : 'Non'}</td>
                    <td>${new Date(trip.returnDate).toLocaleDateString('fr-FR')}</td>
                    <td class="actions-column">
                        <button class="btn btn-warning btn-small" onclick="editTrip(${trip.id})">âï¸ Modifier</button>
                        <button class="btn btn-danger btn-small" onclick="deleteTrip(${trip.id})">ðï¸ Supprimer</button>
                    </td>
                `;
            });
        }

        // Fonction pour modifier un dÃ©placement
        function editTrip(tripId) {
            if (!isAuthenticated) {
                alert('Veuillez vous connecter pour utiliser cette fonctionnalitÃ©.');
                return;
            }
            
            const trip = trips.find(t => t.id === tripId);
            if (!trip) return;

            editingTripId = tripId;

            // Remplir le formulaire de modification
            document.getElementById('editTripId').value = trip.id;
            document.getElementById('editVehicle').value = trip.vehicle;
            document.getElementById('editDriverName').value = trip.driverName;
            document.getElementById('editDriverRegistration').value = trip.driverRegistration;
            document.getElementById('editDepartureDate').value = trip.departureDate;
            document.getElementById('editReturnDate').value = trip.returnDate;
            document.getElementById('editInitialKm').value = trip.initialKm;
            document.getElementById('editFinalKm').value = trip.finalKm;
            document.getElementById('editDistanceTraveled').value = trip.distanceTraveled;
            document.getElementById('editTripType').value = trip.tripType;
            document.getElementById('editTripPurpose').value = trip.tripPurpose;
            document.getElementById('editItinerary').value = trip.itinerary || '';
            document.getElementById('editUsedToll').checked = trip.usedToll;
            document.getElementById('editTollAmount').value = trip.tollAmount || '';
            document.getElementById('editTollDirection').value = trip.tollDirection || 'aller';

            // Afficher/masquer le groupe pÃ©age
            toggleEditTollAmount();

            // Afficher le modal
            document.getElementById('editModal').style.display = 'block';
        }

        // Fonction pour supprimer un dÃ©placement
        function deleteTrip(tripId) {
            if (!isAuthenticated) {
                alert('Veuillez vous connecter pour utiliser cette fonctionnalitÃ©.');
                return;
            }
            
            deletingTripId = tripId;
            document.getElementById('deleteModal').style.display = 'block';
        }

        // Fonction pour confirmer la suppression
        function confirmDelete() {
            const tripIndex = trips.findIndex(t => t.id === deletingTripId);
            if (tripIndex === -1) return;

            const trip = trips[tripIndex];

            // Rembourser le montant du pÃ©age si applicable
            if (trip.usedToll && trip.tollAmount > 0) {
                tollUsage[trip.vehicle] -= trip.tollAmount;
                if (tollUsage[trip.vehicle] < 0) tollUsage[trip.vehicle] = 0;
            }

            // Supprimer le dÃ©placement
            trips.splice(tripIndex, 1);

            // Sauvegarder les donnÃ©es
            saveData();

            // Mettre Ã  jour les affichages
            updateDashboard();
            displayTripsHistory();

            // Fermer le modal
            closeDeleteModal();

            // Afficher un message de confirmation
            alert('DÃ©placement supprimÃ© avec succÃ¨s !');
        }

        // Fonction pour fermer le modal de modification
        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
            editingTripId = null;
        }

        // Fonction pour fermer le modal de suppression
        function closeDeleteModal() {
            document.getElementById('deleteModal').style.display = 'none';
            deletingTripId = null;
        }

        // Fonction pour calculer la distance dans le modal d'Ã©dition
        function calculateEditDistance() {
            const initialKm = parseFloat(document.getElementById('editInitialKm').value) || 0;
            const finalKm = parseFloat(document.getElementById('editFinalKm').value) || 0;
            const distance = finalKm - initialKm;
            
            if (distance >= 0) {
                document.getElementById('editDistanceTraveled').value = distance;
            } else {
                document.getElementById('editDistanceTraveled').value = '';
                alert('Le kilomÃ©trage final ne peut pas Ãªtre infÃ©rieur au kilomÃ©trage initial.');
            }
        }

        // Fonction pour afficher/masquer le montant du pÃ©age dans le modal d'Ã©dition
        function toggleEditTollAmount() {
            const usedToll = document.getElementById('editUsedToll').checked;
            const tollAmountGroup = document.getElementById('editTollAmountGroup');
            
            if (usedToll) {
                tollAmountGroup.style.display = 'block';
            } else {
                tollAmountGroup.style.display = 'none';
                document.getElementById('editTollAmount').value = '';
            }
        }

        // Fonction pour gÃ©rer la soumission du formulaire d'Ã©dition
        function handleEditFormSubmit(e) {
            e.preventDefault();
            
            if (!isAuthenticated) {
                alert('Veuillez vous connecter pour utiliser cette fonctionnalitÃ©.');
                return;
            }
            
            const tripId = parseInt(document.getElementById('editTripId').value);
            const tripIndex = trips.findIndex(t => t.id === tripId);
            if (tripIndex === -1) return;

            const oldTrip = trips[tripIndex];
            
            // RÃ©cupÃ©rer les nouvelles donnÃ©es
            const newTripData = {
                id: tripId,
                vehicle: document.getElementById('editVehicle').value,
                vehicleName: vehicles[document.getElementById('editVehicle').value].name,
                vehiclePlate: vehicles[document.getElementById('editVehicle').value].plate,
                driverName: document.getElementById('editDriverName').value,
                driverRegistration: document.getElementById('editDriverRegistration').value,
                departureDate: document.getElementById('editDepartureDate').value,
                returnDate: document.getElementById('editReturnDate').value,
                initialKm: parseFloat(document.getElementById('editInitialKm').value),
                finalKm: parseFloat(document.getElementById('editFinalKm').value),
                distanceTraveled: parseFloat(document.getElementById('editDistanceTraveled').value),
                tripType: document.getElementById('editTripType').value,
                tripPurpose: document.getElementById('editTripPurpose').value,
                itinerary: document.getElementById('editItinerary').value,
                usedToll: document.getElementById('editUsedToll').checked,
                tollAmount: parseFloat(document.getElementById('editTollAmount').value) || 0,
                tollDirection: document.getElementById('editTollDirection').value
            };

            // Validation des dates
            if (new Date(newTripData.returnDate) < new Date(newTripData.departureDate)) {
                alert('La date de retour ne peut pas Ãªtre antÃ©rieure Ã  la date de sortie.');
                return;
            }

            // Ajuster l'usage du pÃ©age
            // Rembourser l'ancien montant
            if (oldTrip.usedToll && oldTrip.tollAmount > 0) {
                tollUsage[oldTrip.vehicle] -= oldTrip.tollAmount;
            }

            // DÃ©duire le nouveau montant si applicable
            if (newTripData.usedToll && newTripData.tollAmount > 0) {
                const currentTollUsage = tollUsage[newTripData.vehicle] || 0;
                const remainingBalance = 30000 - currentTollUsage;
                
                if (newTripData.tollAmount > remainingBalance) {
                    alert(`Solde insuffisant sur la carte de pÃ©age ! Solde restant : ${remainingBalance.toLocaleString()} F CFA`);
                    // Remettre l'ancien montant
                    if (oldTrip.usedToll && oldTrip.tollAmount > 0) {
                        tollUsage[oldTrip.vehicle] += oldTrip.tollAmount;
                    }
                    return;
                }
                
                tollUsage[newTripData.vehicle] += newTripData.tollAmount;
            }

            // Mettre Ã  jour le dÃ©placement
            trips[tripIndex] = newTripData;

            // Sauvegarder les donnÃ©es
            saveData();

            // Mettre Ã  jour les affichages
            updateDashboard();
            displayTripsHistory();

            // Fermer le modal
            closeEditModal();

            // Afficher un message de succÃ¨s
            alert('DÃ©placement modifiÃ© avec succÃ¨s !');
        }

        // Fonction pour filtrer les dÃ©placements
        function filterTrips() {
            const vehicleFilter = document.getElementById('filterVehicle').value;
            const typeFilter = document.getElementById('filterType').value;
            const driverFilter = document.getElementById('filterDriver').value.toLowerCase();
            
            const tbody = document.getElementById('tripsTableBody');
            const rows = tbody.getElementsByTagName('tr');
            
            Array.from(rows).forEach(row => {
                const vehicleCell = row.cells[1].textContent;
                const typeCell = row.cells[4].textContent.toLowerCase();
                const driverCell = row.cells[2].textContent.toLowerCase();
                
                let showRow = true;
                
                if (vehicleFilter && !vehicleCell.includes(vehicles[vehicleFilter].name)) {
                    showRow = false;
                }
                
                if (typeFilter && !typeCell.includes(typeFilter === 'professional' ? 'prof' : 'privÃ©')) {
                    showRow = false;
                }
                
                if (driverFilter && !driverCell.includes(driverFilter)) {
                    showRow = false;
                }
                
                row.style.display = showRow ? '' : 'none';
            });
        }

        // Fonction pour exporter en CSV
        function exportToCSV() {
            if (!isAuthenticated) {
                alert('Veuillez vous connecter pour utiliser cette fonctionnalitÃ©.');
                return;
            }
            
            if (trips.length === 0) {
                alert('Aucune donnÃ©e Ã  exporter.');
                return;
            }
            
            const headers = [
                'Date de sortie',
                'Date de retour',
                'VÃ©hicule',
                'Plaque',
                'Utilisateur',
                'Matricule',
                'Type de sortie',
                'Objet du dÃ©placement',
                'ItinÃ©raire',
                'Km initial',
                'Km final',
                'Distance parcourue',
                'PÃ©age utilisÃ©',
                'Montant pÃ©age',
                'Direction pÃ©age'
            ];
            
            let csvContent = headers.join(',') + '\n';
            
            trips.forEach(trip => {
                const row = [
                    `"${new Date(trip.departureDate).toLocaleString('fr-FR')}"`,
                    `"${new Date(trip.returnDate).toLocaleString('fr-FR')}"`,
                    `"${trip.vehicleName}"`,
                    `"${trip.vehiclePlate}"`,
                    `"${trip.driverName}"`,
                    `"${trip.driverRegistration}"`,
                    `"${trip.tripType === 'professional' ? 'Professionnelle' : 'PrivÃ©e'}"`,
                    `"${trip.tripPurpose}"`,
                    `"${trip.itinerary || ''}"`,
                    trip.initialKm,
                    trip.finalKm,
                    trip.distanceTraveled,
                    trip.usedToll ? 'Oui' : 'Non',
                    trip.tollAmount || 0,
                    `"${trip.tollDirection || ''}"`
                ];
                csvContent += row.join(',') + '\n';
            });
            
            // CrÃ©er et tÃ©lÃ©charger le fichier
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `carnet_de_bord_${new Date().toISOString().slice(0, 10)}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Initialiser l'application au chargement de la page
        document.addEventListener('DOMContentLoaded', function() {
            // VÃ©rifier l'authentification au dÃ©marrage
            checkAuth();
            
            // DÃ©finir la date actuelle par dÃ©faut
            const now = new Date();
            const dateString = now.toISOString().slice(0, 16);
            document.getElementById('departureDate').value = dateString;
            
            // Ajouter les Ã©couteurs d'Ã©vÃ©nements
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('tripForm').addEventListener('submit', handleFormSubmit);
            document.getElementById('editTripForm').addEventListener('submit', handleEditFormSubmit);
            document.getElementById('vehicle').addEventListener('change', updateVehicleInfo);
            document.getElementById('finalKm').addEventListener('input', calculateDistance);
            document.getElementById('editFinalKm').addEventListener('input', calculateEditDistance);
            document.getElementById('usedToll').addEventListener('change', toggleTollAmount);
            document.getElementById('editUsedToll').addEventListener('change', toggleEditTollAmount);
            document.getElementById('filterVehicle').addEventListener('change', filterTrips);
            document.getElementById('filterType').addEventListener('change', filterTrips);
            document.getElementById('filterDriver').addEventListener('input', filterTrips);

            // Fermer les modals en cliquant Ã  l'extÃ©rieur
            window.addEventListener('click', function(event) {
                const editModal = document.getElementById('editModal');
                const deleteModal = document.getElementById('deleteModal');
                
                if (event.target === editModal) {
                    closeEditModal();
                }
                if (event.target === deleteModal) {
                    closeDeleteModal();
                }
            });
        });
    </script>
</body>
</html>
